{"version":3,"sources":["../../src/telemetry/storage.ts"],"names":["Telemetry","TELEMETRY_KEY_ENABLED","TELEMETRY_KEY_NOTIFY_DATE","TELEMETRY_KEY_ID","TELEMETRY_KEY_SALT","getStorageDirectory","distDir","isLikelyEphemeral","ciEnvironment","isCI","isDockerFunction","path","join","undefined","constructor","notify","isDisabled","conf","get","set","Date","now","toString","console","log","chalk","magenta","bold","cyan","setEnabled","_enabled","enabled","oneWayHash","payload","hash","createHash","update","salt","digest","record","_events","deferred","prom","Promise","resolve","isFulfilled","isRejected","value","submitRecord","then","catch","reason","res","queue","delete","Array","isArray","_controller","add","flush","all","flushDetached","mode","dir","allEvents","forEach","item","abort","push","_","fs","mkdirSync","recursive","writeFileSync","JSON","stringify","child_process","require","spawn","NEXT_TELEMETRY_DEBUG","spawnSync","process","execPath","detached","windowsHide","shell","stdio","events","length","eventName","error","context","anonymousId","projectId","getProjectId","sessionId","meta","getAnonymousMeta","postController","AbortController","_postPayload","map","fields","signal","NEXT_TELEMETRY_DISABLED","env","storageDirectory","Conf","projectName","cwd","randomBytes","Set","val","generated","isEnabled","loadProjectId","getRawProjectId"],"mappings":"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"}