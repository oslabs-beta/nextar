{"version":3,"sources":["../../src/server/web-server.ts"],"names":["NextWebServer","BaseServer","constructor","options","Object","assign","renderOpts","webServerConfig","extendRenderOpts","handleCompression","getIncrementalCache","requestHeaders","dev","IncrementalCache","requestProtocol","appDir","hasAppDir","allowedRevalidateHeaderKeys","nextConfig","experimental","minimalMode","fetchCache","fetchCacheKeyPrefix","maxMemoryCacheSize","isrMemoryCacheSize","flushToDisk","CurCacheHandler","serverOptions","incrementalCacheHandler","getPrerenderManifest","getResponseCache","WebResponseCache","getCustomRoutes","headers","rewrites","fallback","afterFiles","beforeFiles","redirects","run","req","res","parsedUrl","hasPage","page","getPublicDir","getBuildId","buildId","loadEnvConfig","getHasAppDir","pagesType","getHasStaticDir","getFallback","getFontManifest","undefined","getPagesManifest","normalizedPage","getAppPathsManifest","getFilesystemPaths","Set","attachRequestMeta","addRequestMeta","query","prerenderManifest","version","routes","dynamicRoutes","notFoundRoutes","preview","previewModeId","getNextFontManifest","nextFontManifest","normalizeNextData","middleware","getMiddleware","params","getPathMatch","pathname","path","render404","finished","shift","lastParam","length","endsWith","join","getRouteFromAssetPath","trailingSlash","substring","i18n","host","hostname","split","toLowerCase","localePathResult","normalizeLocalePath","locales","domainLocale","i18nProvider","detectDomainLocale","detectedLocale","__nextLocale","__nextDefaultLocale","defaultLocale","__nextDataReq","handleCatchallRenderRequest","Error","isDynamicRoute","routeRegex","getNamedRouteRegex","interpolateDynamicPath","normalizeVercelUrl","keys","routeKeys","removeTrailingSlash","analyze","bubbleNoFallback","_nextBubbleNoFallback","isAPIRoute","render","err","NoFallbackError","handleApiRequest","renderHTML","renderToHTML","disableOptimizedLoading","runtime","sendRenderResult","_req","setHeader","poweredByHeader","type","getHeader","result","contentType","isDynamic","writer","transformStream","writable","getWriter","innerClose","target","write","chunk","end","close","on","_event","cb","off","_cb","onClose","closed","then","pipe","payload","toUnchunkedString","String","byteLength","generateEtags","generateETag","body","send","runApi","findPageComponents","loadComponent","components"],"mappings":";;;;+BA4CA;;;eAAqBA;;;qBAlCM;oEAC0B;sBACxB;6BACE;6DACF;4BACF;2BACE;8EACK;qCACE;qCACA;uBACL;6BAC4B;4BACxB;kCACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqBlB,MAAMA,sBAAsBC,mBAAU;IACnDC,YAAYC,OAAyB,CAAE;QACrC,KAAK,CAACA;QAEN,uBAAuB;QACvBC,OAAOC,MAAM,CAAC,IAAI,CAACC,UAAU,EAAEH,QAAQI,eAAe,CAACC,gBAAgB;IACzE;IAEUC,oBAAoB;IAC5B,wEAAwE;IACxE,4EAA4E;IAC9E;IACUC,oBAAoB,EAC5BC,eAAc,EAGf,EAAE;QACD,MAAMC,MAAM,CAAC,CAAC,IAAI,CAACN,UAAU,CAACM,GAAG;QACjC,wCAAwC;QACxC,kDAAkD;QAClD,oBAAoB;QACpB,OAAO,IAAIC,kCAAgB,CAAC;YAC1BD;YACAD;YACAG,iBAAiB;YACjBC,QAAQ,IAAI,CAACC,SAAS;YACtBC,6BACE,IAAI,CAACC,UAAU,CAACC,YAAY,CAACF,2BAA2B;YAC1DG,aAAa,IAAI,CAACA,WAAW;YAC7BC,YAAY,IAAI,CAACH,UAAU,CAACC,YAAY,CAACJ,MAAM;YAC/CO,qBAAqB,IAAI,CAACJ,UAAU,CAACC,YAAY,CAACG,mBAAmB;YACrEC,oBAAoB,IAAI,CAACL,UAAU,CAACC,YAAY,CAACK,kBAAkB;YACnEC,aAAa,KAAK;YAClBC,iBACE,IAAI,CAACC,aAAa,CAACpB,eAAe,CAACqB,uBAAuB;YAC5DC,sBAAsB,IAAM,IAAI,CAACA,oBAAoB;QACvD;IACF;IACUC,mBAAmB;QAC3B,OAAO,IAAIC,aAAgB,CAAC,IAAI,CAACX,WAAW;IAC9C;IACUY,kBAAkB;QAC1B,OAAO;YACLC,SAAS,EAAE;YACXC,UAAU;gBACRC,UAAU,EAAE;gBACZC,YAAY,EAAE;gBACdC,aAAa,EAAE;YACjB;YACAC,WAAW,EAAE;QACf;IACF;IACA,MAAgBC,IACdC,GAAoB,EACpBC,GAAqB,EACrBC,SAA6B,EACd;QACf,KAAK,CAACH,GAAG,CAACC,KAAKC,KAAKC;IACtB;IACA,MAAgBC,QAAQC,IAAY,EAAE;QACpC,OAAOA,SAAS,IAAI,CAACjB,aAAa,CAACpB,eAAe,CAACqC,IAAI;IACzD;IACUC,eAAe;QACvB,kDAAkD;QAClD,OAAO;IACT;IACUC,aAAa;QACrB,OAAO,IAAI,CAACnB,aAAa,CAACpB,eAAe,CAACC,gBAAgB,CAACuC,OAAO;IACpE;IACUC,gBAAgB;IACxB,2EAA2E;IAC3E,mBAAmB;IACrB;IACUC,eAAe;QACvB,OAAO,IAAI,CAACtB,aAAa,CAACpB,eAAe,CAAC2C,SAAS,KAAK;IAC1D;IACUC,kBAAkB;QAC1B,OAAO,KAAK;IACd;IACA,MAAgBC,cAAc;QAC5B,OAAO;IACT;IACUC,kBAAkB;QAC1B,OAAOC;IACT;IACUC,mBAAmB;QAC3B,OAAO;YACL,8DAA8D;YAC9D,CAAC,IAAI,CAAC5B,aAAa,CAACpB,eAAe,CAChCiD,cAAc,CAAC,EAAE,CAAC,MAAM,EAAE,IAAI,CAAC7B,aAAa,CAACpB,eAAe,CAACqC,IAAI,CAAC,GAAG,CAAC;QAC3E;IACF;IACUa,sBAAsB;QAC9B,MAAMb,OAAO,IAAI,CAACjB,aAAa,CAACpB,eAAe,CAACqC,IAAI;QACpD,OAAO;YACL,CAAC,IAAI,CAACjB,aAAa,CAACpB,eAAe,CAACqC,IAAI,CAAC,EAAE,CAAC,GAAG,EAAEA,KAAK,GAAG,CAAC;QAC5D;IACF;IACUc,qBAAqB;QAC7B,OAAO,IAAIC;IACb;IACUC,kBACRpB,GAAmB,EACnBE,SAAiC,EACjC;QACAmB,IAAAA,2BAAc,EAACrB,KAAK,qBAAqB;YAAE,GAAGE,UAAUoB,KAAK;QAAC;IAChE;IACUjC,uBAAuB;YAE3B;QADJ,MAAM,EAAEkC,kBAAiB,EAAE,GAAG,IAAI,CAACpC,aAAa,CAACpB,eAAe;QAChE,IAAI,CAAA,CAAA,mBAAA,IAAI,CAACD,UAAU,YAAf,KAAA,IAAA,iBAAiBM,GAAG,AAAD,KAAK,CAACmD,mBAAmB;YAC9C,OAAO;gBACLC,SAAS,CAAC;gBACVC,QAAQ,CAAC;gBACTC,eAAe,CAAC;gBAChBC,gBAAgB,EAAE;gBAClBC,SAAS;oBACPC,eAAe;gBACjB;YACF;QACF,CAAC;QACD,OAAON;IACT;IAEUO,sBAAsB;QAC9B,OAAO,IAAI,CAAC3C,aAAa,CAACpB,eAAe,CAACC,gBAAgB,CAAC+D,gBAAgB;IAC7E;IAEA,MAAgBC,kBACdhC,GAAoB,EACpBC,GAAqB,EACrBC,SAAiC,EACD;QAChC,MAAM+B,aAAa,IAAI,CAACC,aAAa;QACrC,MAAMC,SAASC,IAAAA,uBAAY,EAAC,sBAAsBlC,UAAUmC,QAAQ;QAEpE,+CAA+C;QAC/C,mDAAmD;QACnD,IAAI,CAACF,UAAU,CAACA,OAAOG,IAAI,IAAIH,OAAOG,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC/B,OAAO,EAAE;YAC9D,MAAM,IAAI,CAACgC,SAAS,CAACvC,KAAKC,KAAKC;YAC/B,OAAO;gBACLsC,UAAU,IAAI;YAChB;QACF,CAAC;QACD,0BAA0B;QAC1BL,OAAOG,IAAI,CAACG,KAAK;QAEjB,MAAMC,YAAYP,OAAOG,IAAI,CAACH,OAAOG,IAAI,CAACK,MAAM,GAAG,EAAE;QAErD,wCAAwC;QACxC,IAAI,OAAOD,cAAc,YAAY,CAACA,UAAUE,QAAQ,CAAC,UAAU;YACjE,MAAM,IAAI,CAACL,SAAS,CAACvC,KAAKC,KAAKC;YAC/B,OAAO;gBACLsC,UAAU,IAAI;YAChB;QACF,CAAC;QAED,4BAA4B;QAC5B,IAAIH,WAAW,CAAC,CAAC,EAAEF,OAAOG,IAAI,CAACO,IAAI,CAAC,KAAK,CAAC;QAC1CR,WAAWS,IAAAA,8BAAqB,EAACT,UAAU;QAE3C,iDAAiD;QACjD,IAAIJ,YAAY;YACd,IAAI,IAAI,CAACvD,UAAU,CAACqE,aAAa,IAAI,CAACV,SAASO,QAAQ,CAAC,MAAM;gBAC5DP,YAAY;YACd,CAAC;YACD,IACE,CAAC,IAAI,CAAC3D,UAAU,CAACqE,aAAa,IAC9BV,SAASM,MAAM,GAAG,KAClBN,SAASO,QAAQ,CAAC,MAClB;gBACAP,WAAWA,SAASW,SAAS,CAAC,GAAGX,SAASM,MAAM,GAAG;YACrD,CAAC;QACH,CAAC;QAED,IAAI,IAAI,CAACjE,UAAU,CAACuE,IAAI,EAAE;gBAQH;YAPrB,MAAM,EAAEC,KAAI,EAAE,GAAGlD,CAAAA,cAAAA,KAAAA,IAAAA,IAAKP,OAAO,AAAD,KAAK,CAAC;YAClC,mDAAmD;YACnD,MAAM0D,WAAWD,eAAAA,KAAAA,IAAAA,KAAME,KAAK,CAAC,IAAI,CAAC,EAAE,CAACC,WAAW,EAAE;YAClD,MAAMC,mBAAmBC,IAAAA,wCAAmB,EAC1ClB,UACA,IAAI,CAAC3D,UAAU,CAACuE,IAAI,CAACO,OAAO;YAE9B,MAAMC,eAAe,CAAA,qBAAA,IAAI,CAACC,YAAY,YAAjB,KAAA,IAAA,mBAAmBC,mBAAmBR;YAE3D,IAAIS,iBAAiB;YAErB,IAAIN,iBAAiBM,cAAc,EAAE;gBACnCvB,WAAWiB,iBAAiBjB,QAAQ;gBACpCuB,iBAAiBN,iBAAiBM,cAAc;YAClD,CAAC;YAED1D,UAAUoB,KAAK,CAACuC,YAAY,GAAGD;YAC/B1D,UAAUoB,KAAK,CAACwC,mBAAmB,GACjCL,CAAAA,uBAAAA,KAAAA,IAAAA,aAAcM,aAAa,AAAD,KAAK,IAAI,CAACrF,UAAU,CAACuE,IAAI,CAACc,aAAa;YAEnE,IAAI,CAACH,kBAAkB,CAAC3B,YAAY;gBAClC/B,UAAUoB,KAAK,CAACuC,YAAY,GAAG3D,UAAUoB,KAAK,CAACwC,mBAAmB;gBAClE,MAAM,IAAI,CAACvB,SAAS,CAACvC,KAAKC,KAAKC;gBAC/B,OAAO;oBAAEsC,UAAU,IAAI;gBAAC;YAC1B,CAAC;QACH,CAAC;QACDtC,UAAUmC,QAAQ,GAAGA;QACrBnC,UAAUoB,KAAK,CAAC0C,aAAa,GAAG;QAEhC,OAAO;YAAExB,UAAU,KAAK;QAAC;IAC3B;IAEA,MAAgByB,4BACdjE,GAAoB,EACpBC,GAAqB,EACrBC,SAAiC,EACD;QAChC,IAAI,EAAEmC,SAAQ,EAAEf,MAAK,EAAE,GAAGpB;QAC1B,IAAI,CAACmC,UAAU;YACb,MAAM,IAAI6B,MAAM,yBAAwB;QAC1C,CAAC;QAED,4DAA4D;QAC5D,+CAA+C;QAC/C,MAAMlD,iBAAiB,IAAI,CAAC7B,aAAa,CAACpB,eAAe,CAACiD,cAAc;QAExE,IAAIqB,aAAarB,gBAAgB;YAC/BqB,WAAWrB;YAEX,IAAImD,IAAAA,qBAAc,EAAC9B,WAAW;gBAC5B,MAAM+B,aAAaC,IAAAA,8BAAkB,EAAChC,UAAU,KAAK;gBACrDA,WAAWiC,IAAAA,mCAAsB,EAACjC,UAAUf,OAAO8C;gBACnDG,IAAAA,+BAAkB,EAChBvE,KACA,IAAI,EACJpC,OAAO4G,IAAI,CAACJ,WAAWK,SAAS,GAChC,IAAI,EACJL;YAEJ,CAAC;QACH,CAAC;QAED,wDAAwD;QACxD/B,WAAWqC,IAAAA,wCAAmB,EAACrC;QAE/B,IAAI,IAAI,CAACqB,YAAY,EAAE;YACrB,MAAM,EAAEE,eAAc,EAAE,GAAG,MAAM,IAAI,CAACF,YAAY,CAACiB,OAAO,CAACtC;YAC3D,IAAIuB,gBAAgB;gBAClB1D,UAAUoB,KAAK,CAACuC,YAAY,GAAGD;YACjC,CAAC;QACH,CAAC;QAED,MAAMgB,mBAAmB,CAAC,CAACtD,MAAMuD,qBAAqB;QAEtD,IAAIC,IAAAA,sBAAU,EAACzC,WAAW;YACxB,OAAOf,MAAMuD,qBAAqB;QACpC,CAAC;QAED,IAAI;YACF,MAAM,IAAI,CAACE,MAAM,CAAC/E,KAAKC,KAAKoC,UAAUf,OAAOpB,WAAW,IAAI;YAE5D,OAAO;gBACLsC,UAAU,IAAI;YAChB;QACF,EAAE,OAAOwC,KAAK;YACZ,IAAIA,eAAeC,2BAAe,IAAIL,kBAAkB;gBACtD,OAAO;oBACLpC,UAAU,KAAK;gBACjB;YACF,CAAC;YACD,MAAMwC,IAAG;QACX;IACF;IAEA,4DAA4D;IAC5D,MAAgBE,mBAAmB;QACjC,OAAO,KAAK;IACd;IAEUC,WACRnF,GAAmB,EACnBC,GAAoB,EACpBoC,QAAgB,EAChBf,KAAyB,EACzBxD,UAAsB,EACC;QACvB,MAAM,EAAEsH,aAAY,EAAE,GAAG,IAAI,CAACjG,aAAa,CAACpB,eAAe;QAC3D,IAAI,CAACqH,cAAc;YACjB,MAAM,IAAIlB,MACR,oEACD;QACH,CAAC;QAED,kEAAkE;QAClE,8CAA8C;QAC9C,IAAI7B,aAAcvE,CAAAA,WAAWM,GAAG,GAAG,eAAe,aAAa,AAAD,GAAI;YAChEiE,WAAW;QACb,CAAC;QACD,OAAO+C,aACLpF,KACAC,KACAoC,UACAf,OACA1D,OAAOC,MAAM,CAACC,YAAY;YACxBuH,yBAAyB,IAAI;YAC7BC,SAAS;QACX;IAEJ;IAEA,MAAgBC,iBACdC,IAAoB,EACpBvF,GAAoB,EACpBtC,OAMC,EACc;QACfsC,IAAIwF,SAAS,CAAC,kBAAkB;QAEhC,yBAAyB;QACzB,iEAAiE;QACjE,IAAI9H,QAAQ+H,eAAe,IAAI/H,QAAQgI,IAAI,KAAK,QAAQ;YACtD1F,IAAIwF,SAAS,CAAC,gBAAgB;QAChC,CAAC;QAED,IAAI,CAACxF,IAAI2F,SAAS,CAAC,iBAAiB;YAClC3F,IAAIwF,SAAS,CACX,gBACA9H,QAAQkI,MAAM,CAACC,WAAW,GACtBnI,QAAQkI,MAAM,CAACC,WAAW,GAC1BnI,QAAQgI,IAAI,KAAK,SACjB,qBACA,0BAA0B;QAElC,CAAC;QAED,IAAIhI,QAAQkI,MAAM,CAACE,SAAS,EAAE;YAC5B,MAAMC,SAAS/F,IAAIgG,eAAe,CAACC,QAAQ,CAACC,SAAS;YAErD,IAAIC;YACJ,MAAMC,SAAS;gBACbC,OAAO,CAACC,QAAsBP,OAAOM,KAAK,CAACC;gBAC3CC,KAAK,IAAMR,OAAOS,KAAK;gBAEvBC,IAAGC,MAAe,EAAEC,EAAc,EAAE;oBAClCR,aAAaQ;gBACf;gBACAC,KAAIF,MAAe,EAAEG,GAAe,EAAE;oBACpCV,aAAatF;gBACf;YACF;YACA,MAAMiG,UAAU,IAAM;gBACpBX,qBAAAA,KAAAA,IAAAA;YACF;YACA,uEAAuE;YACvE,wEAAwE;YACxE,uBAAuB;YACvBJ,OAAOgB,MAAM,CAACC,IAAI,CAACF,SAASA;YAC5BpJ,QAAQkI,MAAM,CAACqB,IAAI,CAACb;QACtB,OAAO;YACL,MAAMc,UAAU,MAAMxJ,QAAQkI,MAAM,CAACuB,iBAAiB;YACtDnH,IAAIwF,SAAS,CAAC,kBAAkB4B,OAAOC,IAAAA,eAAU,EAACH;YAClD,IAAIxJ,QAAQ4J,aAAa,EAAE;gBACzBtH,IAAIwF,SAAS,CAAC,QAAQ+B,IAAAA,kBAAY,EAACL;YACrC,CAAC;YACDlH,IAAIwH,IAAI,CAACN;QACX,CAAC;QAEDlH,IAAIyH,IAAI;IACV;IACA,MAAgBC,SAAS;QACvB,QAAQ;QACR,OAAO,IAAI;IACb;IAEA,MAAgBC,mBAAmB,EACjCvF,SAAQ,EACRf,MAAK,EACLa,OAAM,EAMP,EAAE;QACD,MAAM0D,SAAS,MAAM,IAAI,CAAC1G,aAAa,CAACpB,eAAe,CAAC8J,aAAa,CACnExF;QAEF,IAAI,CAACwD,QAAQ,OAAO,IAAI;QAExB,OAAO;YACLvE,OAAO;gBACL,GAAIA,SAAS,CAAC,CAAC;gBACf,GAAIa,UAAU,CAAC,CAAC;YAClB;YACA2F,YAAYjC;QACd;IACF;AACF"}