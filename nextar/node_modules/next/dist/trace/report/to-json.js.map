{"version":3,"sources":["../../../src/trace/report/to-json.ts"],"names":["batcher","localEndpoint","serviceName","ipv4","port","reportEvents","events","queue","Set","flushAll","Promise","all","length","report","event","push","evts","slice","add","then","delete","writeStream","traceId","batch","writeStreamOptions","flags","encoding","RotatingWriteStream","constructor","file","sizeLimit","size","createWriteStream","fs","rotate","end","unlinkSync","err","code","rotatePromise","undefined","write","data","drainPromise","resolve","_reject","once","reportToLocalHost","name","duration","timestamp","id","parentId","attrs","startTime","distDir","traceGlobals","get","phase","process","env","TRACE_ID","randomBytes","toString","promises","mkdir","recursive","path","join","PHASE_DEVELOPMENT_SERVER","Infinity","eventsJson","JSON","stringify","console","log","tags"],"mappings":"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"}