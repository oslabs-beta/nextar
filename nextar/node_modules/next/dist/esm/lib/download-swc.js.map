{"version":3,"sources":["../../src/lib/download-swc.ts"],"names":["os","fs","path","Log","tar","fetch","require","WritableStream","fileExists","getRegistry","MAX_VERSIONS_TO_CACHE","getCacheDirectory","result","envDefined","process","env","systemCacheDirectory","platform","XDG_CACHE_HOME","join","homedir","LOCALAPPDATA","dir","tmpdir","console","error","Error","exit","isAbsolute","resolve","cwd","extractBinary","outputDirectory","pkgName","tarFileName","cacheDirectory","extractFromTar","x","file","strip","info","promises","mkdir","recursive","tempFile","Date","now","registry","downloadUrl","then","res","ok","body","status","cacheWriteStream","createWriteStream","pipeTo","write","chunk","close","rename","cacheFiles","readdir","length","sort","a","b","localeCompare","i","unlink","catch","downloadNativeNextSwc","version","bindingsDirectory","triplesABI","triple","substring","downloadWasmSwc","wasmDirectory","variant"],"mappings":"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"}