{"version":3,"sources":["../../src/server/image-optimizer.ts"],"names":["createHash","promises","cpus","mediaType","chalk","contentDisposition","getOrientation","Orientation","imageSizeOf","isAnimated","join","nodeUrl","getImageBlurSvg","hasMatch","createRequestResponseMocks","sendEtagResponse","getContentType","getExtension","AVIF","WEBP","PNG","JPEG","GIF","SVG","ICO","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","concurrency","divisor","NODE_ENV","Math","floor","max","length","e","showSharpMissingWarning","getSupportedMimeType","options","accept","mimeType","includes","getHash","items","hash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","rm","recursive","force","catch","mkdir","writeFile","detectContentType","every","b","i","ImageOptimizerCache","validateParams","req","query","nextConfig","isDev","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","curRevalidate","isStale","_","set","revalidate","Error","err","console","error","ImageError","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","getMaxAge","age","endsWith","slice","n","optimizeImage","contentType","height","nextConfigOutput","optimizedBuffer","transformer","sequentialRead","rotate","resize","undefined","withoutEnlargement","avif","avifQuality","chromaSubsampling","warn","yellow","bold","webp","png","jpeg","toBuffer","orientation","operations","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","processBuffer","imageOptimizer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","mocked","method","socket","res","parse","hasStreamed","concat","buffers","getHeader","cacheControl","dangerouslyAllowSVG","vector","animate","output","getMetadata","meta","opts","blurWidth","blurHeight","blurDataURL","unescape","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","imagesConfig","setHeader","finished","contentDispositionType","contentSecurityPolicy","sendResponse","result","byteLength","end","getImageSize","metadata","decodeBuffer","Deferred","promise","Promise","resolve","reject"],"mappings":"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"}