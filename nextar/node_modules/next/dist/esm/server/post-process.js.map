{"version":3,"sources":["../../src/server/post-process.ts"],"names":["OPTIMIZED_FONT_PROVIDERS","nonNullable","middlewareRegistry","registerPostProcessor","name","middleware","condition","push","processHTML","html","data","options","parse","require","root","document","callMiddleWare","inspectData","inspect","mutate","i","length","FontOptimizerMiddleware","originalDom","getFontDefinition","fontDefinitions","querySelectorAll","filter","tag","getAttribute","hasAttribute","some","url","dataHref","startsWith","forEach","element","nonce","markup","result","preconnectUrls","Set","fontDef","fallBackLinkTag","indexOf","fontContent","replace","nonceStr","dataAttr","includes","escapedUrl","fontRegex","RegExp","provider","find","p","add","preconnect","preconnectTag","postProcessHTML","pathname","content","renderOpts","inAmpMode","hybridAmp","postProcessors","process","env","NEXT_RUNTIME","optimizeAmp","default","ampOptimizerConfig","ampSkipValidation","ampValidator","optimizeFonts","fontManifest","getFontDefinitionFromManifest","optimizeCss","Critters","cssOptimizer","ssrMode","reduceInlineStyles","path","distDir","publicPath","assetPrefix","preload","fonts","postProcessor","__NEXT_OPTIMIZE_FONTS"],"mappings":"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"}